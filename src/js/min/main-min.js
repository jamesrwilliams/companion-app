function onError(e){try{alert("code: "+e.code+"\nmessage: "+e.message+"\n")}catch(t){}}function open_news(e){$("#flyout article").html(""),$("#flyout .header h1").text(content_array[e][3]),$("#flyout article").html("</div><article><h2>"+content_array[e][0]+"</h2>"+content_array[e][4]+"</article><div onclick='close_news()' id='close_button'>"),$("#flyout").animate({right:"0"}),$("body").animate("padding","50px"),news_open=!0}function close_news(){$("#flyout").animate({right:"-100%"}),news_open=!1}function render_news(){for($(".article_list").html(""),i=0;content_array.length>i;i++)$(".article_list").append("<li data-article_number='"+i+"'><h4>"+content_array[i][0]+"</h4><time class='meta'>"+content_array[i][3]+"</time><p>"+content_array[i][2]+"</p></li>");$(".article_list li").click(function(){open_news($(this).attr("data-article_number"))})}function getNews(){$(".article_list").html("<div class='loader'>Loading...</div><p id='news_loading_text'></p>"),content_array.length=0,$.ajax({type:"get",url:"http://wearekiwikiwi.co.uk/feed/",dataType:"xml",success:function(e){$(".article_list").html("");var t=$(e);t.find("item").each(function(){var e=$(this),t={title:e.find("title").text(),link:e.find("link").text(),description:e.find("description").text(),pubDate:e.find("pubDate").text(),content:e.find("encoded").text()},a=[t.title,t.link,t.description,t.pubDate.substring(0,16),t.content];content_array.push(a);var n=JSON.stringify(content_array);window.localStorage.setItem("ots_news_array",n)}),render_news()},error:function(){$(".article_list").html("<div class='loader'>Loading...</div>"),$("#news_loading_text").html("Cannot Load News"),render_news()}})}function closeNav(){$("#NAV").animate({left:"-50%"},animation_speed),$(".page").animate({"margin-left":"0"},animation_speed),$(".RETURN").css("display","none")}function check_distance(e,t,a,n){var o=Math.abs(e-a),i=Math.abs(t-n),r=Math.pow(o,2)+Math.pow(i,2),s=Math.sqrt(r);return s}function openNav(){$("#NAV").animate({left:"0"},animation_speed),$(".page").animate({"margin-left":"50%"},animation_speed),$(".RETURN").css("display","block")}function clear_app_data(){localStorage.removeItem("ots_news_array")}function render_user_data(){$("section.master_nav a:nth-child(1)").text("Player ID: "+player.player_id),$("#player nav#header h1").text("Player ID: "+player.player_id)}function get_user_data(){$.ajax({async:!1,global:!1,url:"player_test_data.json",dataType:"json",success:function(e){settings=e.settings,player=e.player,story=e.story}}),render_user_data()}function render_lore_data(){}function get_lore_data(){$.ajax({async:!1,global:!1,url:"assets/game_data.json",dataType:"json",success:function(e){game_data=e}}),render_lore_data()}function onDeviceReady(){$("#device").html("Device: "+device.model)}var ots_news_array=window.localStorage.getItem("ots_news_array"),content_array=JSON.parse(ots_news_array),news_open=!0,animation_speed=300,user_latitude,user_longitude,map,i,player,story,settings,Hammer,device,alert,game_data,google,onSuccess=function(e){var t=new google.maps.LatLng(51.887533,-2.08875);user_latitude=e.coords.latitude,user_longitude=e.coords.longitude;var a={zoom:17,center:t,disableDefaultUI:!0};map=new google.maps.Map(document.getElementById("map-canvas"),a);var n={fillOpacity:1,fillColor:"white",strokeOpacity:1,strokeColor:"white",strokeWeight:1,scale:1};$.each(game_data.beacons,function(e,t){var a=new google.maps.Marker({position:new google.maps.LatLng(game_data.beacons[e].x,game_data.beacons[e].y),fillColor:game_data.beacons[e].marker.fillColor,fillOpacity:game_data.beacons[e].marker.fillOpacity,strokeColor:game_data.beacons[e].marker.strokeColor,strokeOpacity:game_data.beacons[e].marker.strokeOpacity,strokeWeight:game_data.beacons[e].marker.strokeWeight,icon:{path:google.maps.SymbolPath.CIRCLE,scale:20},map:map}),n={path:google.maps.SymbolPath.CIRCLE,strokeColor:game_data.beacons[e].marker.strokeColor,strokeOpacity:game_data.beacons[e].marker.strokeOpacity,strokeWeight:game_data.beacons[e].marker.strokeWeight,fillColor:game_data.beacons[e].marker.fillColor,fillOpacity:game_data.beacons[e].marker.fillOpacity,map:map,center:new google.maps.LatLng(game_data.beacons[e].x,game_data.beacons[e].y),radius:parseFloat(game_data.beacons[e].marker.radius)},o=new google.maps.Circle(n)})};$(document).ready(function(){navigator.geolocation.getCurrentPosition(onSuccess,onError),document.addEventListener("deviceready",onDeviceReady,!1);var e=new Hammer(document.body);if(null===content_array){ots_news_array=[["","","","",""]];var t=JSON.stringify(ots_news_array);window.localStorage.setItem("ots_news_array",t)}$("#RETURN").click(function(){closeNav()}),$("a#NAVBTN").click(function(){openNav()}),$("#SYNC").click(function(){getNews()}),$("#NAV a").click(function(){closeNav()}),$("#close_btn").click(function(){close_news()}),$("#news_button").click(function(){window.location.href="#news",closeNav()}),$("#gameguide_button").click(function(){window.location.href="#gameguide",closeNav()}),$("#player_button").click(function(){window.location.href="#player",closeNav()}),$("#about_button").click(function(){window.location.href="#about",closeNav()}),$("#settings_button").click(function(){window.location.href="#settings",closeNav()}),$("#infection_button").click(function(){window.location.href="#infection",closeNav()}),$("#button_1").click(function(){var e=new google.maps.Marker({position:new google.maps.LatLng(user_latitude,user_longitude),map:map,title:"Hello World!"});map.panTo(e.getPosition())}),$("#button_2").click(function(){}),e.on("swipe",function(e){4===e.direction?news_open?close_news():openNav():2===e.direction&&closeNav()}),get_lore_data(),get_user_data(),getNews();var a=!1,n,o;$(".lore ul li").click(function(){a?($(this).find(".content").fadeOut(),$(this).delay(100).animate({top:n,bottom:o},500,function(){$(this).toggleClass("content_view"),$(".dynm").remove(),$(this).delay(300).css({position:"static","z-index":"0"})}),a=!1):(n=$(this).position().top,o=$(".main").height()-($(this).height()+$(this).position().top),$(this).before("<li class='dynm'><h3>Item X</h3></li>"),$(this).css({position:"absolute",top:n,bottom:o,"z-index":"90000"}),$(this).toggleClass("content_view"),$(this).delay(100).animate({top:0,bottom:0},function(){$(this).find(".content").html("<h1>Hello World</h1>").hide().fadeIn()}),a=!0)}),$(".clear_app_data").click(function(){navigator.notification.confirm("Clearing this will delete all localdata",clear_app_data)})});